Особенности скрипта:
Гарантированное сохранение файлов - Даже если все файлы старше 30 дней, сохраняются KeepCount последних файлов

Безопасное удаление - Поддержка параметра -WhatIf для тестирования

Валидация параметров:

Проверка существования директории

Ограничения на значения параметров (1-1000 дней, 1-1000 файлов)

Подробное логирование - Отчет о количестве обработанных и удаленных файлов

Обработка ошибок - Перехват исключений с выводом понятных сообщений

Использование:
powershell
# Базовое использование
Remove-OldFiles -Path "C:\Logs" -DaysOld 30 -KeepCount 5

# Тестовый запуск (без реального удаления)
Remove-OldFiles -Path "D:\AppData" -DaysOld 90 -KeepCount 10 -WhatIf

# Параметры по умолчанию (30 дней, сохранить 5 файлов)
Remove-OldFiles -Path "E:\Backups"
Как интегрировать в другие скрипты:
Скопируйте функцию в начало вашего скрипта

Вызывайте с нужными параметрами:

powershell
# В вашем основном скрипте
Remove-OldFiles -Path $logDir -DaysOld 60 -KeepCount 3
Логика работы:
Получает все файлы в указанной директории

Разделяет файлы на две группы:

Актуальные (младше указанного возраста)

Просроченные (старше указанного возраста)

Для просроченных файлов:

Если их больше KeepCount, удаляет все кроме KeepCount самых новых

Если меньше или равно KeepCount - не удаляет ничего

Актуальные файлы никогда не удаляются

Скрипт сохраняет минимальное количество файлов в любом случае, что гарантирует сохранность данных даже при длительном отсутствии обновления файлов в директории.
