# File constitution.md - Конституция PowerShell модуля резервного копирования
**Статус:** УТВЕРЖДЕНО | **Версия:** 1.0 | **Последнее изменение**: 2025-11-12

## Основные принципы

### I. Следование лучшим практикам PowerShell
Весь код должен соответствовать общепринятым стандартам и рекомендациям сообщества PowerShell для обеспечения читаемости, поддерживаемости и производительности.

### II. Простота (KISS - Keep It Simple, Stupid)
Предпочтение отдается простым и понятным решениям. Избегайте излишней сложности. Код должен быть легким для понимания и отладки.

### III. Не повторяйся (DRY - Don't Repeat Yourself)
Избегайте дублирования кода. Используйте функции и модули для переиспользования логики.

### IV. Открытость/Закрытость
Программные сущности (модули, функции) должны быть открыты для расширения, но закрыты для модификации. Новая функциональность добавляется путем расширения, а не изменения существующего кода.

### V. Композиция вместо наследования
Предпочитайте композицию объектов наследованию для достижения гибкости и избежания сложных иерархий.

### VI. Принцип единственной ответственности
Каждый модуль и функция должны иметь одну, четко определенную зону ответственности.

### VII. Вам это не понадобится (YAGNI - You Ain't Gonna Need It)
Реализуйте только ту функциональность, которая требуется в данный момент. Не добавляйте код "на всякий случай".

### VIII. Чистый код лучше "умного"
Предпочтение отдается ясному и читаемому коду, а не сложным и "умным" конструкциям, которые трудно понять.

### IX. Документация в формате PlatyPS
Каждый скрипт, модуль и функция должны быть документированы с использованием синтаксиса комментариев, совместимого с `PlatyPS`. Это обеспечивает возможность автоматической генерации внешних файлов справки (`.xml`) и единообразие документации.

## Архитектура и структура

### I. Модульность
Проект имеет модульную архитектуру. Каждая логическая часть функциональности вынесена в отдельный модуль (`.psm1`).

- **Backup-Logger.psm1**: Централизованное ведение логов.
- **Backup-RAR.psm1**: Работа с RAR архивами.
- **Backup-7z.psm1**: Работа с 7-Zip архивами 7z.
- **Backup-Zip.psm1**: Работа с ZIP архивами средствами PowerShell.
- **Remove-OldFiles.psm1**: Ротация (удаление) старых файлов. Принимает параметры: количество дней для хранения и количество последних файлов, которые нужно сохранить независимо от даты.
- **Mail-Email-Send.psm1**: Отправка email-уведомлений.
- **Backup-Copy.psm1**: Копирование файлов по сети.

### II. Основные скрипты
- **Backup-Main-Folders.ps1**: Главный скрипт для резервного копирования папок.
- **Backup-Main-Files.ps1**: Главный скрипт для резервного копирования отдельных файлов.

## Технические требования

### I. Совместимость
Модуль должен быть полностью совместим с **Windows PowerShell 5.1**.

### II. Документация
Каждая функция и модуль должны содержать подробные комментарии, объясняющие их назначение, параметры и примеры использования.

### III. Обработка ошибок и логирование
- Реализована надежная обработка ошибок с использованием блоков `try...catch`.
- Ведется подробный лог всех операций, включая информационные сообщения, предупреждения и ошибки.
- **Ни одна ошибка не должна приводить к аварийному завершению скрипта без записи в лог.**
- Создается отдельный лог-файл со списком всех файлов, добавленных в архив.

### IV. Процесс резервного копирования
1.  Архивы создаются локально на машине, где запущен скрипт.
2.  После успешного создания и проверки, архивы копируются в указанное сетевое хранилище (например, `\\server\backup`).

## Управление
Эта конституция является основным документом, определяющим правила разработки. Любые изменения в конституции требуют обсуждения и утверждения.


