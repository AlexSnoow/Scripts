Особенности скрипта:
Гарантированное сохранение файлов - Всегда сохраняет последние keep_min файлов (даже если все старше указанного срока)

Параметризация:

Работает с любым путем (по умолчанию C:\Logs)

Настраиваемый период удаления (по умолчанию 30 дней)

Настраиваемое минимальное количество файлов (по умолчанию 5)

Безопасная обработка:

Проверка существования директории

Проверка количества файлов перед удалением

Рекурсивный подсчет файлов

Логирование - Информативные сообщения о процессе выполнения

Использование:
Базовое использование (с параметрами по умолчанию):

cmd
cleanup.cmd
С указанием кастомной директории:

cmd
cleanup.cmd "D:\App\Logs"
С полной кастомизацией (путь, дни, количество):

cmd
cleanup.cmd "E:\Backups" 60 10
Как интегрировать в другие скрипты:
Сохраните как cleanup.cmd

Вызывайте из других скриптов с нужными параметрами:

batch
call cleanup.cmd "C:\IIS_Logs" 90 15
Алгоритм работы:
Получает список всех файлов в директории, отсортированных по дате (новые вверху)

Пропускает первые keep_min файлов (самые новые)

Для остальных файлов:

Проверяет, старше ли они указанного срока

Удаляет только файлы, соответствующие критерию возраста

Никогда не трогает последние keep_min файлов, независимо от их возраста

Примечания:
Для работы требует Windows 7+ (из-за особенностей forfiles)

Корректно обрабатывает пробелы в путях

Для отладки можно добавить echo перед del в строке 22

Не удаляет скрытые файлы (для этого нужно добавить /a-h в команду dir)

Этот скрипт особенно полезен для автоматического обслуживания серверов, где важно сохранять последние версии логов, даже если они устарели по времени.
